-- MySQL Script generated by MySQL Workbench
-- 07/28/18 16:51:16
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8 ;
USE `mydb` ;

-- -----------------------------------------------------
-- Table `mydb`.`user`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`user` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `login` VARCHAR(20) NOT NULL COMMENT 'Логин пользователя.',
  `password` VARCHAR(45) NOT NULL COMMENT 'Пароль пользователя.',
  `e-mail` VARCHAR(45) NOT NULL COMMENT 'Электронный ящик пользователя.',
  `role` VARCHAR(10) NOT NULL COMMENT 'Роль пользователя системы.',
  `first_name` VARCHAR(20) NOT NULL,
  `last_name` VARCHAR(25) NOT NULL,
  `speciality` VARCHAR(20) NULL,
  `doctor_id` INT NULL,
  `activity` TINYINT(1) NOT NULL,
  UNIQUE INDEX `e-mail_UNIQUE` (`e-mail` ASC),
  PRIMARY KEY (`id`),
  UNIQUE INDEX `login_UNIQUE` (`login` ASC),
  INDEX `doctor_id_idx` (`doctor_id` ASC),
  CONSTRAINT `doctor_id`
    FOREIGN KEY (`doctor_id`)
    REFERENCES `mydb`.`user` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = 'Информация указываемая пользователем для входа  в систему.';


-- -----------------------------------------------------
-- Table `mydb`.`order`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`order` (
  `order_id` INT NOT NULL AUTO_INCREMENT COMMENT 'Номер заказа.',
  `order_date` DATETIME NOT NULL COMMENT 'Дата заказа.',
  `customer_id` INT NOT NULL,
  `total` FLOAT NOT NULL,
  PRIMARY KEY (`order_id`),
  INDEX `customer_id_idx` (`customer_id` ASC),
  CONSTRAINT `customer_id`
    FOREIGN KEY (`customer_id`)
    REFERENCES `mydb`.`user` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = 'Информация о всех совершённых заказах.';


-- -----------------------------------------------------
-- Table `mydb`.`drug`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`drug` (
  `drug_id` INT NOT NULL AUTO_INCREMENT COMMENT 'Идентификационный номер препарата.',
  `name` NVARCHAR(45) NOT NULL COMMENT 'Название препарата. Не unique, т.к. допускается наличие препаратов одного вида, но с разным количеством действующего вещества.',
  `dose` INT NULL COMMENT 'Количество действующего вещества.',
  `price` FLOAT NOT NULL,
  `prescription` TINYINT(1) NOT NULL COMMENT 'Нужен ли рецепт.',
  `availability` TINYINT(1) NOT NULL,
  PRIMARY KEY (`drug_id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = big5
COMMENT = 'Информация о препаратах, продаваемых аптекой.';


-- -----------------------------------------------------
-- Table `mydb`.`prescription`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`prescription` (
  `id` INT NOT NULL AUTO_INCREMENT COMMENT 'Номер рецепта',
  `valid_until` DATETIME NOT NULL COMMENT 'До какого числа рецепт действителен.',
  `customer_id` INT NOT NULL COMMENT 'Владелец рецепта.',
  `doctor_id` INT NOT NULL COMMENT 'Врач, выписавший рецепт.',
  `drug_id` INT NOT NULL COMMENT 'Выписанный препарат.',
  `approved` TINYINT(1) NULL,
  PRIMARY KEY (`id`),
  INDEX `fk_Рецепт_Лекарство1_idx` (`drug_id` ASC),
  INDEX `fk_Рецепт_Врач1_idx` (`doctor_id` ASC),
  INDEX `fk_Рецепт_Клиент1_idx` (`customer_id` ASC),
  CONSTRAINT `fk_Рецепт_Врач1`
    FOREIGN KEY (`doctor_id`)
    REFERENCES `mydb`.`user` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Рецепт_Лекарство1`
    FOREIGN KEY (`drug_id`)
    REFERENCES `mydb`.`drug` (`drug_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Рецепт_Клиент1`
    FOREIGN KEY (`customer_id`)
    REFERENCES `mydb`.`user` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = 'Информация о рецептах на препараты.';


-- -----------------------------------------------------
-- Table `mydb`.`order_m2m_drug`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`order_m2m_drug` (
  `order_id` INT NOT NULL COMMENT 'Номер заказа.',
  `drug_id` INT NOT NULL COMMENT 'Номер лекарства.',
  `amount` INT NOT NULL COMMENT 'Количество упаковок лекарства.',
  PRIMARY KEY (`order_id`, `drug_id`),
  INDEX `idЛекарство_idx` (`drug_id` ASC),
  CONSTRAINT `idЗаказ`
    FOREIGN KEY (`order_id`)
    REFERENCES `mydb`.`order` (`order_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `idЛекарство`
    FOREIGN KEY (`drug_id`)
    REFERENCES `mydb`.`drug` (`drug_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = 'Вспомогательная таблица для обеспечения связи М:М.';


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `mydb`.`user`
-- -----------------------------------------------------
START TRANSACTION;
USE `mydb`;
INSERT INTO `mydb`.`user` (`id`, `login`, `password`, `e-mail`, `role`, `first_name`, `last_name`, `speciality`, `doctor_id`, `activity`) VALUES (1, 'First', MD5('qwerty1'), 'first@gmail.com', 'pharmacist', 'Галина', 'Петрова', NULL, NULL, 1);
INSERT INTO `mydb`.`user` (`id`, `login`, `password`, `e-mail`, `role`, `first_name`, `last_name`, `speciality`, `doctor_id`, `activity`) VALUES (2, 'Second', MD5('qwerty2'), 'second@gmail.com', 'doctor', 'Николай', 'Богданов', 'ревматолог', NULL, 1);
INSERT INTO `mydb`.`user` (`id`, `login`, `password`, `e-mail`, `role`, `first_name`, `last_name`, `speciality`, `doctor_id`, `activity`) VALUES (3, 'Third', MD5('qwerty3'), 'third@gmail.com', 'doctor', 'Семен', 'Каспаров', 'терапевт', NULL, 1);
INSERT INTO `mydb`.`user` (`id`, `login`, `password`, `e-mail`, `role`, `first_name`, `last_name`, `speciality`, `doctor_id`, `activity`) VALUES (4, 'Fourth', MD5('qwerty4'), 'fourth@yandex.ru', 'pharmacist', 'Серегей', 'Игнатов', NULL, NULL, 1);
INSERT INTO `mydb`.`user` (`id`, `login`, `password`, `e-mail`, `role`, `first_name`, `last_name`, `speciality`, `doctor_id`, `activity`) VALUES (5, 'Fifth', MD5('qwerty5'), 'fifth@yandex.ru', 'customer', 'Наталья', 'Троцкая', NULL, 2, 1);
INSERT INTO `mydb`.`user` (`id`, `login`, `password`, `e-mail`, `role`, `first_name`, `last_name`, `speciality`, `doctor_id`, `activity`) VALUES (6, 'Sixth', MD5('qwerty6'), 'sixth@gmail.com', 'customer', 'Илья', 'Василенко', NULL, 2, 1);
INSERT INTO `mydb`.`user` (`id`, `login`, `password`, `e-mail`, `role`, `first_name`, `last_name`, `speciality`, `doctor_id`, `activity`) VALUES (7, 'Seventh', MD5('qwerty7'), 'seventh@yahoo.com', 'customer', 'Павел', 'Игорев', NULL, 3, 1);
INSERT INTO `mydb`.`user` (`id`, `login`, `password`, `e-mail`, `role`, `first_name`, `last_name`, `speciality`, `doctor_id`, `activity`) VALUES (8, 'Eighth', MD5('qwerty8'), 'eighth@yahoo.com', 'customer', 'Анна', 'Васильева', NULL, 3, 1);
INSERT INTO `mydb`.`user` (`id`, `login`, `password`, `e-mail`, `role`, `first_name`, `last_name`, `speciality`, `doctor_id`, `activity`) VALUES (9, 'Nineth', MD5('qwerty9'), 'nineth@rambler.ru', 'customer', 'Петр', 'Одинец', NULL, 3, 1);
INSERT INTO `mydb`.`user` (`id`, `login`, `password`, `e-mail`, `role`, `first_name`, `last_name`, `speciality`, `doctor_id`, `activity`) VALUES (10, 'Tenth', MD5('qwerty10'), 'tenth@tut.by', 'pharmacist', 'Татьяна', 'Приходько', NULL, NULL, 1);
INSERT INTO `mydb`.`user` (`id`, `login`, `password`, `e-mail`, `role`, `first_name`, `last_name`, `speciality`, `doctor_id`, `activity`) VALUES (11, 'Eleven', MD5('qwerty11'), 'eleventh@tut.by', 'customer', 'Валентина', 'Валеренко', NULL, 3, 1);
INSERT INTO `mydb`.`user` (`id`, `login`, `password`, `e-mail`, `role`, `first_name`, `last_name`, `speciality`, `doctor_id`, `activity`) VALUES (12, 'Twelve', MD5('qwerty12'), 'twelve@rambler.ru', 'customer', 'Геннадий', 'Клименко', NULL, 3, 1);
INSERT INTO `mydb`.`user` (`id`, `login`, `password`, `e-mail`, `role`, `first_name`, `last_name`, `speciality`, `doctor_id`, `activity`) VALUES (13, 'Thirteen', MD5('qwerty13'), 'thirteen@gmail.com', 'customer', 'Зинаида', 'Рыбак', NULL, 2, 1);

COMMIT;


-- -----------------------------------------------------
-- Data for table `mydb`.`order`
-- -----------------------------------------------------
START TRANSACTION;
USE `mydb`;
INSERT INTO `mydb`.`order` (`order_id`, `order_date`, `customer_id`, `total`) VALUES (1, '2018-06-24 07:34:13', 5, 3);
INSERT INTO `mydb`.`order` (`order_id`, `order_date`, `customer_id`, `total`) VALUES (2, '2018-06-24 14:21:42', 2, 100.43);
INSERT INTO `mydb`.`order` (`order_id`, `order_date`, `customer_id`, `total`) VALUES (3, '2018-06-25 16:03:47', 3, 15.66);
INSERT INTO `mydb`.`order` (`order_id`, `order_date`, `customer_id`, `total`) VALUES (4, '2018-06-26 09:57:01', 6, 11);
INSERT INTO `mydb`.`order` (`order_id`, `order_date`, `customer_id`, `total`) VALUES (5, '2018-06-26 11:15:26', 7, 0.5);
INSERT INTO `mydb`.`order` (`order_id`, `order_date`, `customer_id`, `total`) VALUES (6, '2018-06-26 17:14:52', 8, 23.99);
INSERT INTO `mydb`.`order` (`order_id`, `order_date`, `customer_id`, `total`) VALUES (7, '2018-06-26 20:48:21', 9, 13.98);
INSERT INTO `mydb`.`order` (`order_id`, `order_date`, `customer_id`, `total`) VALUES (8, '2018-06-27 17:03:10', 8, 1);
INSERT INTO `mydb`.`order` (`order_id`, `order_date`, `customer_id`, `total`) VALUES (9, '2018-06-27 18:37:31', 11, 4.44);

COMMIT;


-- -----------------------------------------------------
-- Data for table `mydb`.`drug`
-- -----------------------------------------------------
START TRANSACTION;
USE `mydb`;
INSERT INTO `mydb`.`drug` (`drug_id`, `name`, `dose`, `price`, `prescription`, `availability`) VALUES (1, 'Мукалтин', 250, 0.5, 0, 1);
INSERT INTO `mydb`.`drug` (`drug_id`, `name`, `dose`, `price`, `prescription`, `availability`) VALUES (2, 'Бисептол', 20, 3, 0, 1);
INSERT INTO `mydb`.`drug` (`drug_id`, `name`, `dose`, `price`, `prescription`, `availability`) VALUES (3, 'Анальгин', 50, 2.44, 0, 1);
INSERT INTO `mydb`.`drug` (`drug_id`, `name`, `dose`, `price`, `prescription`, `availability`) VALUES (4, 'Пирацетам', 100, 7, 1, 1);
INSERT INTO `mydb`.`drug` (`drug_id`, `name`, `dose`, `price`, `prescription`, `availability`) VALUES (5, 'Глицин', 30, 2.99, 0, 1);
INSERT INTO `mydb`.`drug` (`drug_id`, `name`, `dose`, `price`, `prescription`, `availability`) VALUES (6, 'Омез', 25, 5.49, 0, 1);
INSERT INTO `mydb`.`drug` (`drug_id`, `name`, `dose`, `price`, `prescription`, `availability`) VALUES (7, 'Авелокс', 10, 55, 1, 1);
INSERT INTO `mydb`.`drug` (`drug_id`, `name`, `dose`, `price`, `prescription`, `availability`) VALUES (8, 'Мелоксикам', 15, 4, 0, 1);
INSERT INTO `mydb`.`drug` (`drug_id`, `name`, `dose`, `price`, `prescription`, `availability`) VALUES (9, 'Месакол', 400, 50, 0, 1);
INSERT INTO `mydb`.`drug` (`drug_id`, `name`, `dose`, `price`, `prescription`, `availability`) VALUES (10, 'Индометацин', 50, 1.49, 0, 1);
INSERT INTO `mydb`.`drug` (`drug_id`, `name`, `dose`, `price`, `prescription`, `availability`) VALUES (11, 'Ксефокам', 8, 8.99, 0, 1);
INSERT INTO `mydb`.`drug` (`drug_id`, `name`, `dose`, `price`, `prescription`, `availability`) VALUES (12, 'Ксефокам', 4, 6.49, 0, 1);
INSERT INTO `mydb`.`drug` (`drug_id`, `name`, `dose`, `price`, `prescription`, `availability`) VALUES (13, 'Азитромицин', 40, 14.99, 1, 1);
INSERT INTO `mydb`.`drug` (`drug_id`, `name`, `dose`, `price`, `prescription`, `availability`) VALUES (14, 'Офлоксацин', 20, 11.49, 1, 1);

COMMIT;


-- -----------------------------------------------------
-- Data for table `mydb`.`prescription`
-- -----------------------------------------------------
START TRANSACTION;
USE `mydb`;
INSERT INTO `mydb`.`prescription` (`id`, `valid_until`, `customer_id`, `doctor_id`, `drug_id`, `approved`) VALUES (1, '2018-06-04 23:59:59', 3, 13, 13, 1);
INSERT INTO `mydb`.`prescription` (`id`, `valid_until`, `customer_id`, `doctor_id`, `drug_id`, `approved`) VALUES (2, '2018-08-15 23:59:59', 3, 13, 7, NULL);
INSERT INTO `mydb`.`prescription` (`id`, `valid_until`, `customer_id`, `doctor_id`, `drug_id`, `approved`) VALUES (3, '2018-09-23 23:59:59', 2, 12, 4, NULL);
INSERT INTO `mydb`.`prescription` (`id`, `valid_until`, `customer_id`, `doctor_id`, `drug_id`, `approved`) VALUES (4, '2018-09-30 23:59:59', 7, 12, 14, NULL);
INSERT INTO `mydb`.`prescription` (`id`, `valid_until`, `customer_id`, `doctor_id`, `drug_id`, `approved`) VALUES (5, '2018-11-01 23:59:59', 11, 13, 14, 0);

COMMIT;


-- -----------------------------------------------------
-- Data for table `mydb`.`order_m2m_drug`
-- -----------------------------------------------------
START TRANSACTION;
USE `mydb`;
INSERT INTO `mydb`.`order_m2m_drug` (`order_id`, `drug_id`, `amount`) VALUES (1, 2, 1);
INSERT INTO `mydb`.`order_m2m_drug` (`order_id`, `drug_id`, `amount`) VALUES (3, 13, 3);
INSERT INTO `mydb`.`order_m2m_drug` (`order_id`, `drug_id`, `amount`) VALUES (3, 7, 1);
INSERT INTO `mydb`.`order_m2m_drug` (`order_id`, `drug_id`, `amount`) VALUES (3, 1, 1);
INSERT INTO `mydb`.`order_m2m_drug` (`order_id`, `drug_id`, `amount`) VALUES (2, 4, 1);
INSERT INTO `mydb`.`order_m2m_drug` (`order_id`, `drug_id`, `amount`) VALUES (4, 3, 2);
INSERT INTO `mydb`.`order_m2m_drug` (`order_id`, `drug_id`, `amount`) VALUES (5, 14, 4);
INSERT INTO `mydb`.`order_m2m_drug` (`order_id`, `drug_id`, `amount`) VALUES (6, 5, 1);
INSERT INTO `mydb`.`order_m2m_drug` (`order_id`, `drug_id`, `amount`) VALUES (7, 8, 2);
INSERT INTO `mydb`.`order_m2m_drug` (`order_id`, `drug_id`, `amount`) VALUES (8, 6, 1);
INSERT INTO `mydb`.`order_m2m_drug` (`order_id`, `drug_id`, `amount`) VALUES (8, 12, 1);
INSERT INTO `mydb`.`order_m2m_drug` (`order_id`, `drug_id`, `amount`) VALUES (9, 14, 2);

COMMIT;